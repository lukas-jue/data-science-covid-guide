<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Exploratory Data Analysis | Data Science Project Guide: Covid-19</title>
  <meta name="description" content="Everything you need to know for your successful TechAcademy Data Science Project" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Exploratory Data Analysis | Data Science Project Guide: Covid-19" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Everything you need to know for your successful TechAcademy Data Science Project" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Exploratory Data Analysis | Data Science Project Guide: Covid-19" />
  
  <meta name="twitter:description" content="Everything you need to know for your successful TechAcademy Data Science Project" />
  

<meta name="author" content="TechAcademy e.V." />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="introduction-to-your-project.html"/>
<link rel="next" href="covid-19-prediction.html"/>
<script src="libs/header-attrs-2.1/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Covid-19 Data Science Project</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Welcome!</a></li>
<li class="chapter" data-level="2" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html"><i class="fa fa-check"></i><b>2</b> What’s Data Science and How Do I Do It?</a>
<ul>
<li class="chapter" data-level="2.1" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#whats-r"><i class="fa fa-check"></i><b>2.1</b> What’s R?</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#rstudio-cloud"><i class="fa fa-check"></i><b>2.1.1</b> RStudio Cloud</a></li>
<li class="chapter" data-level="2.1.2" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#curriculum"><i class="fa fa-check"></i><b>2.1.2</b> Curriculum</a></li>
<li class="chapter" data-level="2.1.3" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#links"><i class="fa fa-check"></i><b>2.1.3</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#whats-python"><i class="fa fa-check"></i><b>2.2</b> What’s Python?</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#anaconda-and-jupyter"><i class="fa fa-check"></i><b>2.2.1</b> Anaconda and Jupyter</a></li>
<li class="chapter" data-level="2.2.2" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#curriculum-1"><i class="fa fa-check"></i><b>2.2.2</b> Curriculum</a></li>
<li class="chapter" data-level="2.2.3" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#links-1"><i class="fa fa-check"></i><b>2.2.3</b> Links</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#your-data-science-project"><i class="fa fa-check"></i><b>2.3</b> Your Data Science Project</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#coding-meetups-and-requirements"><i class="fa fa-check"></i><b>2.3.1</b> Coding Meetups and Requirements</a></li>
<li class="chapter" data-level="2.3.2" data-path="whats-data-science-and-how-do-i-do-it.html"><a href="whats-data-science-and-how-do-i-do-it.html#data-sources"><i class="fa fa-check"></i><b>2.3.2</b> Data Sources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduction-to-your-project.html"><a href="introduction-to-your-project.html"><i class="fa fa-check"></i><b>3</b> Introduction to Your Project</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduction-to-your-project.html"><a href="introduction-to-your-project.html#purpose-of-the-project-guide"><i class="fa fa-check"></i><b>3.1</b> Purpose of the Project Guide</a></li>
<li class="chapter" data-level="3.2" data-path="introduction-to-your-project.html"><a href="introduction-to-your-project.html#what-is-this-project-about"><i class="fa fa-check"></i><b>3.2</b> What is this Project About?</a></li>
<li class="chapter" data-level="3.3" data-path="introduction-to-your-project.html"><a href="introduction-to-your-project.html#exploratory-data-analysis-getting-to-know-the-data-set"><i class="fa fa-check"></i><b>3.3</b> Exploratory Data Analysis – getting to know the data set</a></li>
<li class="chapter" data-level="3.4" data-path="introduction-to-your-project.html"><a href="introduction-to-your-project.html#prediction-apply-statistical-methods"><i class="fa fa-check"></i><b>3.4</b> Prediction – Apply Statistical Methods</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>4</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#import-clean-and-transform-the-data-for-your-first-plot"><i class="fa fa-check"></i><b>4.1</b> Import, Clean and Transform the Data for Your First Plot</a></li>
<li class="chapter" data-level="4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualize-stock-data"><i class="fa fa-check"></i><b>4.2</b> Visualize Stock Data</a></li>
<li class="chapter" data-level="4.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualize-covid-19-infection-data"><i class="fa fa-check"></i><b>4.3</b> Visualize Covid-19 Infection Data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#worldwide-development-of-confirmed-cases"><i class="fa fa-check"></i><b>4.3.1</b> Worldwide Development of Confirmed Cases</a></li>
<li class="chapter" data-level="4.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#stacked-area-plot-by-country"><i class="fa fa-check"></i><b>4.3.2</b> Stacked Area Plot by Country</a></li>
<li class="chapter" data-level="4.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#all-curves-in-one-plot"><i class="fa fa-check"></i><b>4.3.3</b> All Curves in One Plot</a></li>
<li class="chapter" data-level="4.3.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#barplot-by-country"><i class="fa fa-check"></i><b>4.3.4</b> Barplot by Country</a></li>
<li class="chapter" data-level="4.3.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#mortality-rate"><i class="fa fa-check"></i><b>4.3.5</b> Mortality Rate</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualization-with-maps"><i class="fa fa-check"></i><b>4.4</b> Visualization with Maps</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#color-countries-by-confirmed-cases"><i class="fa fa-check"></i><b>4.4.1</b> Color Countries by Confirmed Cases</a></li>
<li class="chapter" data-level="4.4.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#enhance-your-map"><i class="fa fa-check"></i><b>4.4.2</b> Enhance Your Map</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="covid-19-prediction.html"><a href="covid-19-prediction.html"><i class="fa fa-check"></i><b>5</b> Covid-19 Prediction</a>
<ul>
<li class="chapter" data-level="5.1" data-path="covid-19-prediction.html"><a href="covid-19-prediction.html#feature-engineering-and-correlation-analysis"><i class="fa fa-check"></i><b>5.1</b> Feature Engineering and Correlation Analysis</a></li>
<li class="chapter" data-level="5.2" data-path="covid-19-prediction.html"><a href="covid-19-prediction.html#build-a-simple-model-prototype"><i class="fa fa-check"></i><b>5.2</b> Build a Simple Model Prototype</a></li>
<li class="chapter" data-level="5.3" data-path="covid-19-prediction.html"><a href="covid-19-prediction.html#refine-your-simple-regression-model"><i class="fa fa-check"></i><b>5.3</b> Refine Your Simple Regression Model</a></li>
<li class="chapter" data-level="5.4" data-path="covid-19-prediction.html"><a href="covid-19-prediction.html#extend-your-model-to-several-countries"><i class="fa fa-check"></i><b>5.4</b> Extend Your Model to Several Countries</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="excercise-checklist.html"><a href="excercise-checklist.html"><i class="fa fa-check"></i><b>6</b> Excercise Checklist</a></li>
<li class="divider"></li>
<li><a href="https://tech-academy.io/" target="blank">&copy 2020 TechAcademy e.V.</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science Project Guide: Covid-19</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="exploratory-data-analysis" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Exploratory Data Analysis</h1>
<p>Before you can dive into the data, set up your programming environment. This will be the place where the magic happens – all your coding will take place there.</p>
<div class="tips r">
<p>In your workspace on <a href="https://rstudio.cloud/projects">rstudio.cloud</a> we have already uploaded an “assignment” for you (Template Coronavirus). When you create a new project within the workspace “Class of ’20 | TechAcademy | Data Science with R”, your own workspace will open up. We’ve already made some arrangements for you: The data sets that you will be working with throughout the project are already available in your working directory. We also created an RMarkdown file, with which you will be able to create a detailed report of your project. You can convert this file into a PDF document when you have completed the documentation. Open the file “Markdown_Corona.Rmd” and see for yourself!</p>
</div>
<div class="tipsp python">
<p>On <a href="http://tech-academy.io/jupyter">JupyterHub</a> you will find the folder “coronavirus”. There, you will find a folder with your name – please create and store your Jupyter notebooks inside there.
All the necessary data is stored in the folder “data” which is also located in the “coronavirus” folder.</p>
</div>
<div id="import-clean-and-transform-the-data-for-your-first-plot" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Import, Clean and Transform the Data for Your First Plot</h2>
<p>In this section you will get to apply the basics of working with data: You will import, clean and transform the data so that you will then be able to visualize it in the next step.</p>
<p>Visualization is one of the most helpful methods to get a feeling for the relation of the various variables of the data set. As already mentioned, this process is called Exploratory Data Analysis (EDA).</p>
<p>Did you know that Google provides quite extensive public access to the relative number of search queries over time? You can simply type in a keyword and Google returns the public’s relative interest in that topic over time. First have a look at the <a href="https://trends.google.de/trends">Google Trends</a> website for yourself. An interesting way to ease into the whole topic of the coronavirus outbreak is to look at a plot of the Google Trends development with respect to the virus. To visualize the number of people searching for “coronavirus” online, first import the Google Trends data set into your workspace and name it accordingly. We have already downloaded the data for you. It is always helpful to give meaningful names to your data sets and variables so that you don’t get confused later on when you have several different data sets and variables in your workspace.</p>
<p>Now it is time to get a quick overview of the data set. What is the structure of the data set, which variables does it contain, what is the type of the variables? What is noticeable?</p>
<p>Before we can get started with the actual visualization, we have to tweak the data set a little so that the different commands will work later on. Sometimes this is easier said than done and very often the format of the data is not usable at first – you have to figure out why and how to manipulate the data make it useful for your next steps.</p>
<p>To create a time series plot in the next step, it is necessary for the date variable to have the right format. Do you already know how to do that from your DataCamp courses?</p>
<p>After having changed the data to a coherent and meaningful format, it is now time to create our first line plot. Before you actually plot the data, it is helpful to envision what it could look like. Which variable has to be on the x- and y-axis, respectively?</p>
<p>This is what a visualization could look like, but don’t worry, your result does not have to look exactly like this as long as the structure of the plot is similar.</p>
<p><img src="output_files/figure-html/unnamed-chunk-2-1.png" width="1152" /></p>
<p>Looking at the line plot, you can see a clear pattern with respect to different dates. Do you know what happened on the dates the spikes in searches occurred? If you have time you can play with the visualization and refine it, add labels and change colors, but that is not too important, so you can first have a look at the following steps and come back to this when you have completed the rest.</p>
<div class="tips r">
<p><code>R</code> provides many different ways to import data. For starters, use the built-in <code>base</code> function <code>read.csv()</code> and define the path to the Google Trends file in the argument of the function. We have stored all data for your project in the folder <code>data</code>. Don’t forget to use quotation marks <code>”...”</code> for the path – you always need to use them when you specify <code>string</code>-variables in <code>R</code>. Also, you will need to adapt to the <code>R</code>-way of specifying paths. Defining a file path can either be done with <code>\\</code> or <code>/</code>, but not via a single backslash <code>\</code> like in your explorer.</p>
<p>Use the <code>base</code> functions <code>str()</code> and <code>summary()</code> to print useful information on the data type and summary statistics for your <code>gtrends</code> data set.</p>
<p>Converting data types is relatively straightforward. Just use the useful functions in the format <code>as.&lt;&lt;insert data type here&gt;&gt;</code>. If you don’t convert the <code>date</code> variable from a factor to a more useful data type, you will have problems plotting it.</p>
<p>For your first plot, use the simple <code>base</code> function <code>plot()</code> and define the two relevant input vectors for the time and the relative number of searches. While this function is great for very fast initial plots, you will need a more advanced graphics package later on. Do the same plot again with <code>ggplot2</code>. That gives you way more control and flexibility over plotting. Remember from your DataCamp courses that you first need to install a package once and then load it with the <code>library()</code> command at the beginning of your <code>R</code> session.</p>
</div>
<div class="tipsp python">
<p>To import csv-files into your Jupyter notebook and to convert them into a pandas data frame use pandas’ <code>.read_csv()</code> method.
To read the data, you have to tell pandas the path to the files in the data folder from your current directory. To traverse upwards in the directory structure, you have to use two dots, so something like <code>../data/&lt;here the rest of the path&gt;</code> should work. For the first plot you need the Google trends data.
Afterwards use pandas’ <code>.head()</code>, <code>.describe()</code>, and the <code>.info()</code> methods to explore the data: Are the dates actually stored as datetime objects? If not, you can change objects to datetime with <code>pd.to_datetime(df.date, format=’%Y-%m-%d’)</code>, where <code>df</code> stands for the data frame.
It would probably make sense to have the date-column set as index: You can do so by applying the <code>.set_index(‘date’)</code> method to your data frame.
Now the only thing left to do is to plot your first graph!</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="exploratory-data-analysis.html#cb1-1"></a>plt.plot(df[‘hits’])</span></code></pre></div>
<p>Make the plot visually more appealing by using additional pyplot methods and by passing additional arguments to those methods. For example:</p>
<ul>
<li>For the <code>.plot()</code> method you can use additional keyword arguments, like <code>color</code>, <code>marker</code>, <code>linewidth</code>, <code>linestyle</code>, and <code>markersize</code>.</li>
<li>Use the <code>.legend()</code> method to add a legend.</li>
<li>You can also add labels to your x- and y-axis by passing a string argument to the <code>.xlabel()</code> and <code>.ylabel()</code> methods.</li>
<li>You can rotate the ticks on the x-axis with <code>.plt.xticks(rotation=45)</code>.</li>
</ul>
<p>Find a full list of methods in the <a href="https://matplotlib.org/3.1.1/api/pyplot_summary.html">official matplotlib documentation</a>.</p>
</div>
</div>
<div id="visualize-stock-data" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Visualize Stock Data</h2>
<p>The coronavirus had an impact on many areas of our lives and our economy, the stock market being one of them. When visualizing the stock data, the impact becomes evident. Many firms suffered from the outbreak, others profited. Let’s have a look!</p>
<p>As before, you first need to import the stock market dataset and name it accordingly. Once more, it makes sense to get an overview of the data to see what you are working with. Can you already see which variables need to be transformed?</p>
<p>Before visualizing the stock data, try to change the names of the stock symbols, so that people who are not familiar with them know which firm’s stocks are being analyzed.</p>
<p>This time, we will not create a single line plot but several next to each other, which allows for a better comparison of the stock price development of different firms. The following plots are supposed to give you an orientation of what your result could look like:</p>
<p>You can often see vertical lines in the plots to highlight when an event happened that had a severe impact on a variable. Try to add that to the plots. Here is an idea of what it could look like:</p>
<p><img src="output_files/figure-html/unnamed-chunk-4-1.png" width="1152" /></p>
<p>After you visualized the data, think about what the data tells you and which key statements you can derive and communicate with your visualization. Take those ideas and put them into the title and subtitle of the graph. This practice leads the consumers of your visualizations directly to your key message. People looking at your graph for the first time will then more easily and faster spot the important takeaways from your plot.</p>
<div class="tips r">
<p>Use the package <code>ggplot2</code> and add <code>facet_wrap()</code> after you specified the essential geom(s) to automatically create individual subplots.</p>
<p>Then look at how much more complex this task is in <code>Python</code> and be happy that you chose <code>R</code>.</p>
<p>To draw vertical lines to your plots, use another <code>geom</code> and simply add it to your <code>ggplot</code>.</p>
<p>You can label individual entries of a factor-type vector. That doesn’t change the specific entries in the vector, but changes how the entries are displayed for example in plots. Use the function <code>levels()</code> to define the levels of the stock symbols.</p>
</div>
<div class="tipsp python">
<p>Import the stock data as a data frame and explore the data, just as you’ve done with the Google Trends data. Notice that by using only the <code>.head()</code> method, one could think that the csv-file contains only data about one single stock – this is not the case.</p>
<p>It would probably be easier to work with a data frame which only contains the columns we actually need, i.e. <code>symbol</code>, <code>date</code>, and <code>close</code>. Also, it would probably be nicer to work with the data frame if the <code>date</code> column would be the index column, the values of the <code>symbol</code> column would represent the column names, and the <code>close</code> prices would be the data frame’s values: Let’s use pandas’ <code>.pivot()</code> method to achieve both at once: <code>df.pivot(index=..., columns=..., values=...)</code>.</p>
<p>Check if the new index is formatted as a datetime object. If not, apply the same method as you did on the Google Trends data frame.
Now take a look at the whole data frame: Do you notice the <code>NaN</code>s? Try to find out why this is the case by searching it up online. However, if we would plot this data frame in a plot, we might end up with broken lines. One workaround to avoid this, could be to use the <code>.interpolate()</code> method on the data frame, which fills the <code>NaN</code> values using a linear method by default.</p>
<p>To create multiple plots in one figure you can use the example code below as a template. The code starts by creating a figure object, which is a container for plot elements. The function <code>plt.subplot(2,2,i)</code> adds a plot in the i-th window of the 2x2 grid inside the figure. Then, the data frame is filtered by the Netflix stock and the <code>plt.plot()</code> method is used to create the first plot.
Continue filling the next windows of the 2x2 grid with stock data from other companies.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="exploratory-data-analysis.html#cb2-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">20</span>,<span class="dv">8</span>))</span>
<span id="cb2-2"><a href="exploratory-data-analysis.html#cb2-2"></a>plt.subplot(<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>)</span>
<span id="cb2-3"><a href="exploratory-data-analysis.html#cb2-3"></a>data <span class="op">=</span> stocks[stocks.symbol<span class="op">==</span> symbols[‘NFLX’]][<span class="st">&#39;close&#39;</span>]</span>
<span id="cb2-4"><a href="exploratory-data-analysis.html#cb2-4"></a>plt.plot(data)</span></code></pre></div>
<p>You can add a vertical line to point out a date where stock prices started to become very volatile with <code>plt.axvline(x=pd.Timestamp('YYYY-MM-DD'), ymin=0, ymax=1)</code>, whereby x is the coordinate for the x axis, ymin is the bottom and ymax the top of the line.
You used pretty much the same code four times in a row, in such a case it is often good to use a for-loop of the form:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="exploratory-data-analysis.html#cb3-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">4</span>)</span>
<span id="cb3-2"><a href="exploratory-data-analysis.html#cb3-2"></a>    <span class="co"># your code here</span></span></code></pre></div>
<p>Can you find a way to reduce your code using a for-loop? Try to address the changing parts of your code with the index i in the for-loop.</p>
<p>Afterwards you can try to make your plot look nicer.
Use <code>fig.suptitle()</code> to add a title.
If you feel like needing to adjust spaces between the plots, you can use the <code>plt.subplots_adjust()</code> to do so.
Try using <code>fig.autofmt_xdate()</code> to format the date tick labels. If you need help with these functions, try to find out what they do and how to use them in the <a href="https://matplotlib.org/3.2.1/contents.html">matplotlib documentation</a>.</p>
</div>
</div>
<div id="visualize-covid-19-infection-data" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Visualize Covid-19 Infection Data</h2>
<div id="worldwide-development-of-confirmed-cases" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Worldwide Development of Confirmed Cases</h3>
<p>Over the last couple of months you heard new numbers about the coronavirus every day, so it is time to bring some clarity into the development of the virus in different countries over time. So now that we had a first look at certain data sets with a connection to the coronavirus, it is time to look at the coronavirus data itself.</p>
<p>The first data set that you are going to import contains data about the number of confirmed cases all over the world. Name it accordingly and once again, have a look at its structure.</p>
<p>As you can see, we have missing values in the confirmed variable. Your task will be to replace those with the value 0. We can do this because we can assume that if there is a missing value it is most likely that there has not been a confirmed case yet.</p>
<p>Once again it makes sense to create a simple line plot to take a look at the number of confirmed cases over time. In the first step, we will have a look at the worldwide development. For that you will have to transform the data. At this point, our data set has a separate number of confirmed cases for each country per day. In the end, our transformed data set should summarize this so that we only have one number per day that represents the aggregate number of confirmed cases worldwide.</p>
<p>This is what your plot could look like:
You can see that the line plot has a small kink around February 10th. Restict the y-axis if you don’t see it on first glance to the interval <span class="math inline">\(y =[0,100.000]\)</span>. What happened at that point in time that had such a great impact on the number of confirmed cases?</p>
<p><img src="output_files/figure-html/unnamed-chunk-7-1.png" width="1152" /></p>
<div class="tips r">
<p>Import the new panel data set <code>confirmed.csv</code> and analyze its structure
like you did in the previous exercise. Are you noticing the <code>NA</code> entries in the variable <code>confirmed</code>? Replace those missing values with <code>0</code>. There are several ways to do that, one is using <code>ifelse()</code>. After you replaced the missing values, check if you were successful by summing up all entries in the logical vector generated by <code>is.na()</code>. If this sum is zero, you have replaced all <code>NA</code> values. This works because <code>R</code> treats the logical values <code>TRUE</code> and <code>FALSE</code> as <code>1</code> and <code>0</code>.</p>
<p>Also, <code>read.csv()</code> by default imports dates as factors. Transform the column <code>time</code> to the appropriate <code>date</code> variable type.</p>
<p>You’ve probably already heard about the <code>tidyverse</code> – a highly influential and very useful set of packages that all follow a common philosophy. Even if it might be tough to get used to the tidy way of thinking, you will love it once you have understood it.</p>
<p>You can use the <code>dplyr</code> package to summarize <code>confirmed</code> by <code>time</code>. Remember the pipe-operator <code>%&gt;%</code> from the DataCamp course <a href="https://www.datacamp.com/courses/data-manipulation-with-dplyr-in-r">Data Manipulation with dplyr in R</a>? This operator will come in handy to build longer data transformation pipelines. Use a combination of the <code>dplyr</code> functions that group and summarize data. In case you don’t remember their names and arguments, familiarize yourself with the <code>dplyr</code> documentation by typing <code>?dplyr</code> into your console or by googling the problem. In general, <code>?</code> leads you to the documentation of packages or functions in <code>R</code>.</p>
<p>Use <code>ggplot2</code> again to visualize your newly generated time series. Don’t forget to provide meaningful labels for your title, subtitle and axes.</p>
</div>
<div class="tipsp python">
<p>Import the <code>confirmed.csv</code> data as a new data frame and fill the empty spaces (<code>NaN</code>) using <code>.fillna(0)</code>. Afterwards you can use <code>df.isna()</code> to check if there are no missing values in the data frame. This will return True (corresponds to 1) and False (corresponds to 0) if there is a missing value or not. If you <code>sum()</code> over this data frame, you get the amount of missing values which should be zero now.</p>
<p>Since we are not interested in every single country’s number of confirmed cases yet, the idea is to group all dates together by summing up the numbers of confirmed cases for each day. You can use pandas’ <code>groupby()</code> function, which itself returns no result – you also have to apply an aggregation function like <code>groupby(by=’time’).max()</code>, <code>groupby(by=’time’).mean()</code> or <code>groupby(by=’time’).sum()</code>. For this task you can use the latter.
The time column should now be set as index – make sure that its values are formatted as datetime objects.
Finally, you can create the graph by passing the right column of the data frame to the <code>plot()</code> method of the matplotlib library.</p>
</div>
</div>
<div id="stacked-area-plot-by-country" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Stacked Area Plot by Country</h3>
<p>You have gained some experience in creating simple line plots so let’s take it a step further and create a stacked area plot for the countries with the highest number of confirmed cases. The idea behind this is that you add up individual time series and color the area in between by country. This is a little tricky but with patience you will get there. The first step will be to select the countries with the highest number of confirmed cases on the most recent date of the data set. The result should look similar to this:</p>
<p><img src="output_files/figure-html/unnamed-chunk-8-1.png" width="1152" /></p>
<div class="tips r">
<p>First, extract the names of the nine countries that are most affected on the most recent date. Use <code>filter()</code> to only keep the most recent date. You should use <code>arrange()</code> to order the data frame in descending order by <code>confirmed</code>. Then extract the top nine entries and select the column <code>country</code>. Save this vector as <code>top_countries</code> for later use.</p>
<p>Now prepare the data set for plotting. Filter it such that only data for <code>top_countries</code> remains. You might want to use the <code>%in%</code> operator for that task.</p>
<p>To draw the plot, use <code>ggplot2</code> and add the geom that generates an area plot.</p>
<p>The countries in the plot are not ordered in an ideal way for this visualization – countries are sorted alphabetically. Remember <code>levels()</code> that define the ordering of <code>factor</code> variables? Order those by <code>confirmed</code> cases, such that the most affected country comes last.</p>
</div>
<div class="tipsp python">
<p>First you need to know which are the 9 countries with the most confirmed cases. Use the <code>groupby()</code> function with the appropriate aggregation function.</p>
<p>Afterwards you can sort the returned data frame with the <code>df.sort_values()</code> function and use index slicing to get only the first 9 entries of the data frame. Then store it under the variable name <code>top_countries</code>.</p>
<p>Now we know which countries should be visualized in the plot. For each of these countries we need the amount of confirmed cases over time. To get the confirmed cases for one country, we filter the whole data frame by this country and afterwards group the filtered data frame by time.</p>
<p>Because we have to repeat the same procedure with each of the 9 countries, it is a good idea to use a for-loop and iterate over the list of countries stored in <code>top_countries</code>.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="exploratory-data-analysis.html#cb4-1"></a><span class="co"># store data in list</span></span>
<span id="cb4-2"><a href="exploratory-data-analysis.html#cb4-2"></a>confirmed_list <span class="op">=</span> []</span>
<span id="cb4-3"><a href="exploratory-data-analysis.html#cb4-3"></a> </span>
<span id="cb4-4"><a href="exploratory-data-analysis.html#cb4-4"></a><span class="co"># for-loop over the countries</span></span>
<span id="cb4-5"><a href="exploratory-data-analysis.html#cb4-5"></a><span class="cf">for</span> country <span class="kw">in</span> top_countries:</span>
<span id="cb4-6"><a href="exploratory-data-analysis.html#cb4-6"></a>    confirmed_list.append(<span class="co">#your code to filter confirmed cases by country)</span></span></code></pre></div>
<p>In each iteration of the for-loop, append only the values of confirmed cases to a list which you instantiate before the for-loop. At the end of the for-loop you should have a list of pandas series (data frame with just one column) , each containing only the amount of confirmed cases per country over time. To get only values of a pandas series, you can use <code>df[&lt;column_name&gt;].values</code>.</p>
<p>This list contains the amount of confirmed cases, but not the dates. The dates are the same for each country, so we just need to get a pandas series of one of the filtered countries, select the <code>time</code> column and store it under the variable <code>dates</code>.</p>
<p>To get the stacked area chart, you can use the matplotlib function <code>plt.stackplot(x,y,labels)</code>. For the y values you can just pass the list of data frames which we created before and the x values should be the list of dates. The labels are the corresponding names of the countries.</p>
</div>
</div>
<div id="all-curves-in-one-plot" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> All Curves in One Plot</h3>
<p>Having had a closer look at the confirmed cases, we can go ahead and get more into detail by adding data of dead and recovered patients. But we don’t want to keep the three data sets separate, so your next task is to merge the three data sets before we analyze the numbers more thoroughly. You can have a first glimpse at the data and look at the structure. You can see that all three data sets share the same structure, and identical observations share the same ID. This makes it easy because it allows you to merge them by ID.</p>
<p>Similar to your first data set, the merged data frame has missing values. Replace them once again with the value 0.</p>
<p>When talking about the coronavirus many people are only mentioning the total number of confirmed cases. But it makes sense to keep track of the currently infected patients and not only the total infected. This way it is easier to see whether the virus is actually receding or still on the rise. This means we want to have a look at the number of confirmed cases that are still infected and not dead or healed already. For this you can subtract the number of deaths and recovered cases from the number of confirmed cases and create a new variable that you can call <code>netinfected</code>. Visualize the development of confirmed cases, deaths, netinfected, and recovered in an area plot for the top 9 countries.</p>
<p>A quick remark on the underlying data for <code>recovered</code> and thereby also <code>netfinfected</code>: At first, Johns Hopkins University (JHU) provided the variable <code>recovered</code>. Over time, gathering reliable data on the number of healed patients grew increasingly difficult.
German hospitals for example have no legal obligation to report when a patient recovered.
That’s why JHU stopped providing this data. As a quick work-around, we assume that two weeks after patients were infected they count as recovered if they did not die. This is a rough estimate and will not always be true, but sometimes you have to make some reasonable assumptions to work with real-world data.</p>
<p>If everything went well your result will look similar to this:</p>
<p><img src="output_files/figure-html/unnamed-chunk-11-1.png" width="1152" /></p>
<div class="tips r">
<p>Import the data sets <code>deaths.csv</code> and <code>recovered.csv</code> and check out their format and structure. Notice that similarly to <code>confirmed.csv</code>, they also include the column <code>id</code>, which uniquely identifies a single date for one country across those data sets.</p>
<p>Now merge the three data frames by <code>id</code> into <code>df_merged</code>, which should include all three quantities <code>confirmed</code>, <code>deaths</code>, and <code>recovered</code>. You can either use the <code>base</code> function <code>merge()</code> or the more powerful <code>..._join()</code> from the <code>dplyr</code> package. <code>...</code> stands for either <code>left</code>, <code>right</code>, <code>inner</code>, or <code>full</code>. Those adjectives define which columns to keep after merging. The <code>dplyr</code> <a href="https://rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf">cheat sheet</a> provides a more detailed explanation on those tools.</p>
<p>After you merged the data frames, again replace the <code>NA</code> values with 0.
Now create the new variable <code>netinfected</code>. Use <code>$</code> to specify the new variable and simply define it as the appropriate subtraction involving the three variables <code>confirmed</code>, <code>deaths</code>, and <code>recovered</code>.</p>
<p>After once again filtering the <code>top_countries</code> from the full data set, we want to transform the data frame from a <em>wide</em> format into a <em>long</em> format. You have probably heard of <code>gather()</code> and <code>spread()</code> from the <code>tidyr</code> package in your courses. Those functions work well for this task, but there is an enhanced set of functions from the same package that just got released and work even more intuitively. Load <code>library(tidyr)</code> and familiarize yourself with the new functions <code>pivot_longer()</code> and <code>pivot_wider()</code>. Use one of them to accomplish the task. Use the structure below.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="exploratory-data-analysis.html#cb5-1"></a>df_merged <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-2"><a href="exploratory-data-analysis.html#cb5-2"></a><span class="co"># filter here</span></span>
<span id="cb5-3"><a href="exploratory-data-analysis.html#cb5-3"></a><span class="co"># mutate here (optional)</span></span>
<span id="cb5-4"><a href="exploratory-data-analysis.html#cb5-4"></a><span class="st">  </span><span class="kw">pivot_...</span>(<span class="op">&lt;</span><span class="er">&lt;</span>first var to pivot<span class="op">&gt;</span><span class="er">&gt;:&lt;&lt;</span>last var to pivot<span class="op">&gt;</span><span class="er">&gt;</span>,</span>
<span id="cb5-5"><a href="exploratory-data-analysis.html#cb5-5"></a>            <span class="dt">names_to =</span> <span class="st">&quot;...&quot;</span>,</span>
<span id="cb5-6"><a href="exploratory-data-analysis.html#cb5-6"></a>            <span class="dt">values_to =</span> <span class="st">&quot;...&quot;</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-7"><a href="exploratory-data-analysis.html#cb5-7"></a><span class="kw">ggplot</span>() <span class="op">+</span></span>
<span id="cb5-8"><a href="exploratory-data-analysis.html#cb5-8"></a>...</span></code></pre></div>
<p>Your first attempts might look totally weird. Play around with <code>ggplot2</code> by varying the type of plot (e.g. line or area). You can visually separate the individual columns by assigning the variable <code>status</code> to the arguments <code>color =</code> and <code>linetype =</code> within the aesthetics of <code>geom_line(aes(...))</code>.</p>
<p>Another enhancement of your visualization is to plot <code>recovered</code> and <code>deaths</code> on the negative part of the y-axis. This avoids overplotting and enables a better communication of the data. In the previous code chunk above is a predefined space to do just that transformation. Use <code>mutate()</code> to replace the values of the two variables with its negative ones.</p>
</div>
<div class="tipsp python">
<p>First, we need to merge the data frames <code>confirmed</code>, <code>deaths</code> and <code>recovered</code> – which means we want to form one big data frame containing the information of the three individual data frames. They share the same column <code>id</code> and can be merged over this value. You can merge two data frames with the pandas merge function: <code>merged_df = pd.merge(df1, df2, on=’id’)</code>. Now you still need to merge the third data frame.</p>
<p>After the three data frames are merged, we have to fill up <code>NaN</code>s (missing values) with the pandas <code>df.fillna(0)</code> function.</p>
<p>Now we want to compute the amount of <code>netinfected</code> people, which can be computed by <code>netinfected = confirmed – recovered – deaths</code>. Create a new column in the data frame and compute this value for each row.</p>
<p>We want to plot four time series per country. Therefore, we filter the complete data frame after the corresponding countries and use, similar to the exercise before, the <code>df.groupby()</code> function and group now by <code>time</code>. Again we have to use the right aggregation function on the <code>groupby()</code> function. But this time we need – besides the <code>confirmed</code> column – also the <code>deaths</code>, <code>recovered</code> and <code>netinfected</code> columns. You could use a simple line plot with <code>plt.plot()</code> or the function <code>plt.fill_between(x,y)</code> to get a plot which looks similar to the given example.</p>
<p>It is a bit tricky to get several plots into one figure, therefore we provide again an example code.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="exploratory-data-analysis.html#cb6-1"></a><span class="cf">for</span> i <span class="kw">in</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>,<span class="dv">6</span>]:</span>
<span id="cb6-2"><a href="exploratory-data-analysis.html#cb6-2"></a>    plt.subplot(<span class="dv">2</span>,<span class="dv">3</span>,i)</span>
<span id="cb6-3"><a href="exploratory-data-analysis.html#cb6-3"></a>    plt.fill_between(x_data, y_data)</span></code></pre></div>
<p>Fill the <code>plt.fill_between()</code> or <code>plt.plot()</code> function in each iteration of the for-loop with data of another country and the graphs will be plotted in the corresponding windows of the plot-grid.
When you run your code and you can see a grid of plots, each showing four time series of different countries, you can be proud of you. You mastered an advanced concept of the matplotlib library – which can be frustrating from time to time.</p>
<p>Now you can beautify the plot a bit. Add the name of the country as title to each plot (<code>plt.title(‘Taka-Tuka-Land’)</code>). The plots for <code>deaths</code> and <code>recovered</code> contribute negatively to <code>netinfected</code> and should be plotted as negative values as shown in the example plot. Furthermore, the x-ticks should show the date, but they are not readable at the moment.</p>
<p>Try to rotate the ticks and plot only every <span class="math inline">\(10^{th}\)</span> date. To plot only every <span class="math inline">\(n^{th}\)</span> tick is a bit challenging and we need help! We google something like <code>python matplotlib only nth tick</code>. Most of the time this will lead to the website Stackoverflow where somebody had the same problem as you and got help from other programmers. Look into the answers of <a href="https://stackoverflow.com/questions/12608788/changing-the-tick-frequency-on-x-or-y-axis-in-matplotlib/31997618">this Stackoverflow post</a>. Several users proposed possible solutions. Can you find one which works for you? And don’t be afraid if you don’t understand some parts of their code, try-and-error is a good way to learn and find solutions.</p>
</div>
</div>
<div id="barplot-by-country" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Barplot by Country</h3>
<p>Although this is a great way of visualizing the development of the virus outbreak, some characteristics are hard to make out in this kind of visualization. Hence, it makes sense to take the same measures and create a bar plot with them. This should look like this:</p>
<p><img src="output_files/figure-html/unnamed-chunk-14-1.png" width="1152" /></p>
<div class="tips r">
<p>Use the same data frame and transformations from wide to long as in the last plot. Additionally, filter only the most recent snapshot by using <code>filter(time == max(...))</code>. One of the great features of <code>ggplot2</code> is that you can easily switch from one type of plot to another one, just by changing the geom. For a barplot, use <code>geom_bar</code> and specify its aesthetics correctly within that geom to create four different bars for each country.</p>
<p>You might want to flip both axes to have your barplot better structured. There is a very intuitive command to achieve that in <code>ggplot2</code>. Google yourself to the solution.</p>
</div>
<div class="tipsp python">
<p>Use the data frame from before, i.e. the data frame should contain at least the columns representing countries, numbers of deaths, time, net infected, and number of confirmed cases.
If you happen to have converted any column to its negative, then convert it back to positive.
Since we are not interested in the whole time series, but only in the latest data available, we can filter the data frame by the latest available date. You can use <code>.max()</code> to get the <code>highest</code> date in the appropriate column and use <code>df[df[‘time’] == latest_date]</code> to filter by the columns of that date.</p>
<p>We only want to plot nine countries with the highest number of confirmed cases: Sort by the appropriate column doing <code>df.sort_values(by=[‘...’], ascending=False)</code>, and then slice the data frame such that it only consists of 9 rows.</p>
<p>This time we are going to use pandas for plotting (which uses matplotlib’s pyplot - so it is actually still creating matplotlib objects). We do so because it may be more intuitive in this case.</p>
<p>Our data frame should only contain the relevant columns, namely <code>country</code>, <code>confirmed</code>, <code>deaths</code>, <code>recovered</code>, and <code>netinfected</code>. You can select these columns by passing a list of column names in an indexing operator: <code>df[[‘col1’, ‘col2’, ...]]</code>. Afterwards, set the <code>country</code> column as the data frame’s index.</p>
<p>Finally, create a figure using <code>plt.figure()</code> and plot the horizontal bars:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="exploratory-data-analysis.html#cb7-1"></a>df.plot.barh(ax<span class="op">=</span>plt.gca(), width<span class="op">=</span><span class="fl">0.5</span>, title<span class="op">=</span>’Best Plot Ever’, fontsize<span class="op">=</span><span class="dv">10</span>)</span></code></pre></div>
<p>Notice that, as already mentioned, we are using pandas’ <code>df.plot.barh()</code> indestad of matplotlib’s <code>plt.barh()</code> method (which we are going to use in the next exercise).
<code>gca()</code> stands for get current axes and returns the current axes instance on the current figure. If the current axes don’t exist, the appropriate axes will be created. You can try to create the plot without the <code>ax</code> keyword argument and see what happens.</p>
<p>Don’t forget to adjust/add title, labels, etc.</p>
</div>
</div>
<div id="mortality-rate" class="section level3" number="4.3.5">
<h3><span class="header-section-number">4.3.5</span> Mortality Rate</h3>
<p>Apart from the number of net infected, the mortality rate is another measure that is important for evaluating the risk of the coronavirus pandemic. Which variables would you choose to calculate the mortality rate? Would you pick deaths/confirmed cases, deaths/recovered or deaths/net infected? Choose a measure and give a reason for your decision. Then calculate a new variable for the mortality rate. In the next step, create a bar plot of the 35 countries with the highest mortality rate. Are you surprised by some countries that show up in this ranking? Is there a country with an extraordinarily high mortality rate that does not seem to make sense? Could you come up with a reason for this? Is there a way to filter the countries so that your barplot becomes more representative of the actual mortality rates?</p>
<p>In the next step, highlight the countries with the highest number of total confirmed cases.
The finished bar plot that has the nine countries that have the most confirmed cases highlighted should look similar to this:</p>
<p><img src="output_files/figure-html/unnamed-chunk-16-1.png" width="1152" /></p>
<p>Even after filtering out outliers, you can still see that there is a big difference between the countries with regard to the mortality rate. Can you explain this difference? Is it the actual mortality rate that varies between countries or is another factor at play here? What about testing? How does it affect the mortality rate?</p>
<p>As a Data Scientist, it is especially crucial to think about what the data tells you. Do not always take your fancy results at face value. The newly calculated mortality rate might be such a case, where you shouldn’t jump to conclusions. Why do you think it is problematic to calculate the mortality rate like we did during an ongoing pandemic? If you had all the resources that you needed, how would you collect data and calculate the mortality rate? And when would you do it?</p>
<div class="tips r">
<p>Again, filter only the most recent snapshot by using <code>filter(time == max(...))</code>. Now use <code>mutate()</code> to calculate the mortality rate and add it to the data frame as a new column. You already know how to do a barplot from the previous hint. You can once more use <code>arrange()</code> to order the rows in descending order – this time by <code>mortality</code>.</p>
<p>To highlight certain columns of the plot, use the powerful package <code>gghighlight</code> and simply add its function for this task to your plot. Specify the countries you want to highlight as an argument. Maybe <code>top_countries</code> from the previous sections comes in handy here?</p>
</div>
<div class="tipsp python">
<p>The tricky part here is to highlight countries with a high number of confirmed cases.
The basic idea is to create two data frames: One with the top X countries by number of confirmed cases and another one with the top Y countries by death rate. Then iterate through each country in the second data frame (mortality rate), and see which countries can also be found in the first data frame (confirmed cases).
For countries where this is the case, we know we have to color them in a different color.</p>
<p>Let’s start by creating those two new data frames: You can reuse the data frame that you used just before the slicing step in the last exercise and do the following:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="exploratory-data-analysis.html#cb8-1"></a>highest_confirmed <span class="op">=</span> df_old</span>
<span id="cb8-2"><a href="exploratory-data-analysis.html#cb8-2"></a>highest_mortality <span class="op">=</span> df_old</span></code></pre></div>
<p>The first data frame should contain the top 20 (or so) countries with the highest number of confirmed cases (you need to sort and slice). We need this data frame only to determine the colors of the bars.
For the second one you need to add a new column displaying the mortality rate for each country: <code>df.assign(‘mortality_rate’=….)</code>. In place of the dots, you will need to insert your formula of choice (for example you could divide the <code>deaths</code> column by the <code>confirmed</code> column). Afterwards, filter the data frame by the 35 countries with the highest mortality rate. This is the data frame that will actually be plotted.</p>
<p>Now we can take care of the coloring: When plotting with <code>plt.barh()</code>, matplotlib allows us to pass a list of colors as an argument, whereby the first color in that list determines the color of the first bar, the second color determines the color of the second bar, and so on. Note that the <code>first</code> bar actually corresponds to the first row in the data frame.
For example [‘red’, ‘red’, ‘yellow’] would color the first and second bar red, but the third bar (i.e. third row in data frame) yellow.</p>
<p>For us, this means that we can iterate through each country in the <code>highest_mortality</code> data frame and check if that country is also in the <code>highest_confirmed</code> data frame. If this is the case, we know we have to color that bar in a different color:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="exploratory-data-analysis.html#cb9-1"></a>cols <span class="op">=</span> <span class="bu">list</span>()  <span class="co"># initiate empty list</span></span>
<span id="cb9-2"><a href="exploratory-data-analysis.html#cb9-2"></a> </span>
<span id="cb9-3"><a href="exploratory-data-analysis.html#cb9-3"></a><span class="cf">for</span> country <span class="kw">in</span> highest_mortality[‘country’]:</span>
<span id="cb9-4"><a href="exploratory-data-analysis.html#cb9-4"></a>    <span class="co"># if country also in highest_confirmed, then highlight in blue</span></span>
<span id="cb9-5"><a href="exploratory-data-analysis.html#cb9-5"></a>    <span class="cf">if</span> country <span class="kw">in</span> highest_confirmed[‘country’].values:</span>
<span id="cb9-6"><a href="exploratory-data-analysis.html#cb9-6"></a>        cols.append(‘blue’)</span>
<span id="cb9-7"><a href="exploratory-data-analysis.html#cb9-7"></a>    <span class="cf">else</span>:</span>
<span id="cb9-8"><a href="exploratory-data-analysis.html#cb9-8"></a>        cols.append(‘grey’)</span></code></pre></div>
<p>Again, understand that the first color in the <code>cols</code> list determines the color of the first bar (i.e. the first row, or country, in our data frame).
Can you create the color list in one line making use of python’s list comprehension?</p>
<p>Now, everything is ready to be plotted with <code>plt.barh(highest_mortality[‘country’], highest_mortality[’mortality_rate’], color=cols)</code>.</p>
</div>
</div>
</div>
<div id="visualization-with-maps" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Visualization with Maps</h2>
<p>This part will be the final and most advanced part of the EDA – but also the most rewarding. If you have ever checked the news during the coronavirus outbreak you must have come across a world map with information of how the virus is spreading and how badly each country is affected. You will now build your own map where you can show which countries are affected and how high the number of confirmed cases is. Instead of having to rely on others’ decisions regarding the visualization of data on the virus, by creating your own map you can decide freely which type of maps visualization you prefer and which information you want to highlight.</p>
<p>You already have coordinates included in your data set but some data transformation is still necessary. It can get a little tricky, but as before we will give you hints along the way so that you will have an idea of what to do.</p>
<p>Up until this point the basic ideas of the tasks were the same for the Python and R track so the introduction to the exercises was the same, but for the maps tasks, the output will vary significantly between the tracks. That is why you will find every information necessary as well as the output you are working towards in the respective track boxes.</p>
<div id="color-countries-by-confirmed-cases" class="section level3" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Color Countries by Confirmed Cases</h3>
<div class="tips r">
<p>For this section, we’ve already prepared a new data set. Load <code>world_map.csv</code> into your workspace and have a look at the included variables. It contains all data to draw all countries’ borders on a map. Also, we’ve merged the Covid-19 data on a single day to the spatial data.</p>
<p>We will start with a basic map that shows all countries on a world map and colors them according to the number of confirmed cases. How convenient that we can also use our favorite graphics package <code>ggplot2</code> for that task. Supply the plot’s aesthetics with the longitude and latitude as x and y-coordinates, respectively. Additionally, every country is identified by a unique <code>group</code>. We need to supply this to the aesthetics as well by <code>aes(..., group = group)</code> such that the function knows which data points belong to the same country. As geom, we will use <code>geom_polygon()</code> to draw the borders. Use the argument <code>fill = ...</code> to determine the color of a country based on <code>confirmed</code>.</p>
<p>A problem you will run into with this technique of map generation is that the plot will be distorted if you change its size. Countries will become wider or longer than you might be used to when looking at a typical map. This issue is connected to the broader challenge of projecting areas on a ball (the earth) from a 3D element to a simple 2D map. Check online how you can handle the proper projection in <code>ggplot2</code> and implement that in your map.</p>
<p><img src="output_files/figure-html/unnamed-chunk-19-1.png" width="1152" /></p>
</div>
<div class="tipsp python">
<p>As a first step, we want to visualize the outbreak in each country with circles, where each country’s circle size is is dependent on the amount of confirmed cases.</p>
<p>Let’s start by importing the familiar <code>confirmed.csv</code> file.
The goal of our map is to inform the viewer about the number of confirmed cases per country for the latest date available: Find out the latest date and filter the data frame by that date.</p>
<p>Filter the data frame by the columns of interest to facilitate the iteration over each row. The columns are: <code>country</code>, <code>latitude</code>, <code>longitude</code>, and <code>confirmed</code>.
Now that our data frame is in the right format, it is time to check out the documentation of the <a href="https://ipyleaflet.readthedocs.io/en/latest/">ipyleaflet library</a>. This is the library we will use to create our maps.</p>
<p>For our first map, we will use the module “Circle Marker”. Please be sure to take a look at the example in the documentation before proceeding, especially for knowing which modules you need to import!</p>
<p>If you copy-paste-run the example in the docs, you can see that it plots only one single circle on the map – but we want multiple circles!</p>
<p>Let’s start by making sure that when creating the instance <code>m</code> of the <code>Map</code> class you pass the positional argument <code>center=(48, -2)</code> (which might differ from the example in the documentation):</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="exploratory-data-analysis.html#cb10-1"></a>m <span class="op">=</span> Map(center<span class="op">=</span>(<span class="dv">48</span>, <span class="op">-</span><span class="dv">2</span>), zoom<span class="op">=</span><span class="dv">9</span>, basemap<span class="op">=</span>basemaps.CartonDB.Positron)</span>
<span id="cb10-2"><a href="exploratory-data-analysis.html#cb10-2"></a><span class="co"># Feel free to change the zoom and layout of the basemap.</span></span></code></pre></div>
<p>In order to plot multiple circles, you may want to iterate through every row in your data frame. Doing so, you will find it helpful to use the following technique:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="exploratory-data-analysis.html#cb11-1"></a><span class="cf">for</span> i, country, <span class="bu">long</span>, lat, nr <span class="kw">in</span> confirmed_df.itertuples(index<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb11-2"><a href="exploratory-data-analysis.html#cb11-2"></a>    <span class="cf">pass</span>  <span class="co"># your for-loop body here</span></span></code></pre></div>
<p>In each iteration you would need to create an instance of the <code>CircleMarker</code> class.
Additionally, call the methods <code>.location()</code>, <code>.radius()</code>, <code>.color()</code>, and <code>.fill_color()</code> and pass on the right arguments. In the same iteration call the <code>.add_layer()</code> method with the above instance of the <code>CircleMarker</code> as its argument.</p>
<p>Note: Think about a way to roughly size the circles, such that the viewer has an idea about the number of cases in each country listed in our data. Obviously, if you just set the number of confirmed cases as the radius, the circles are going to look way too big. Maybe use something like the logarithm of that number?</p>
<p>It probably won’t look great on your first try – just give it another shot!</p>
</div>
<div class="tipsp python">
<p>This is what your map could look like:</p>
<p><img src="plots/p-map-circle.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="enhance-your-map" class="section level3" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Enhance Your Map</h3>
<div class="tips r">
<p>The next map will be the most advanced one – plot all European countries, color them according to the number of deaths and draw a label that states the number of deaths in that country. First, extract the <code>countrycode</code> of all countries within Europe. We provide you with a country lookup table that defines the region (e.g. Europe) for every individual country. Import this data set and extract the desired country codes into a vector. Use this structure:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="exploratory-data-analysis.html#cb12-1"></a>country_lookup &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&quot;your/path/country_lookup.csv&quot;</span>)</span>
<span id="cb12-2"><a href="exploratory-data-analysis.html#cb12-2"></a>country_lookup <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb12-3"><a href="exploratory-data-analysis.html#cb12-3"></a><span class="st">  </span><span class="kw">filter</span>(region <span class="op">==</span><span class="st"> </span>“<span class="op">&lt;</span><span class="er">&lt;</span>specify region here<span class="op">&gt;</span><span class="er">&gt;</span>”) <span class="op">%&gt;%</span></span>
<span id="cb12-4"><a href="exploratory-data-analysis.html#cb12-4"></a><span class="st">  </span><span class="co"># in case you want to exclude more countries, filter them here         </span></span>
<span id="cb12-5"><a href="exploratory-data-analysis.html#cb12-5"></a><span class="st">  </span><span class="kw">pull</span>(alpha<span class="fl">.3</span>) -&gt;<span class="st"> </span>countrycode_europe</span></code></pre></div>
<p>Now you want to calculate the geographic center of a country. This will help you to place the label on the country later on. Generate that data set with the following hints:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="exploratory-data-analysis.html#cb13-1"></a>world_map <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-2"><a href="exploratory-data-analysis.html#cb13-2"></a><span class="co"># group and summarize the variables of interest here  </span></span>
<span id="cb13-3"><a href="exploratory-data-analysis.html#cb13-3"></a><span class="co"># filter your data frame to only have the relevant countries</span></span>
<span id="cb13-4"><a href="exploratory-data-analysis.html#cb13-4"></a><span class="st">  </span><span class="kw">filter</span>(countrycode ...) <span class="op">%&gt;%</span></span>
<span id="cb13-5"><a href="exploratory-data-analysis.html#cb13-5"></a><span class="co"># create column with labels:</span></span>
<span id="cb13-6"><a href="exploratory-data-analysis.html#cb13-6"></a><span class="co"># Use “\n” within a string as a line break between </span></span>
<span id="cb13-7"><a href="exploratory-data-analysis.html#cb13-7"></a><span class="co"># the country name and the number of confirmed cases</span></span>
<span id="cb13-8"><a href="exploratory-data-analysis.html#cb13-8"></a><span class="co"># generate a new variable that contains the label in a string format</span></span>
<span id="cb13-9"><a href="exploratory-data-analysis.html#cb13-9"></a><span class="co"># then assign everything to a new data frame in the last line</span></span>
<span id="cb13-10"><a href="exploratory-data-analysis.html#cb13-10"></a>... -&gt;<span class="st"> </span>label_centroids</span></code></pre></div>
<p>Now you can generate a map in the same way as in the first maps exercise. Filter all European countries from <code>world_map</code> using <code>countrycode_europe</code>. After adding the polygons, use the package <code>ggrepel</code> and its function <code>geom_label_repel()</code> to draw the labels. Provide the required argument(s), and define aes(…) differently than in geom_polygon(). Hint: use your newly generated data frame <code>label_centroids</code>. It is important to set <code>inherit.aes = FALSE</code>, otherwise <code>ggplot2</code> inherits the aesthetics from the geom before.</p>
<p>Now enhance the appearance of your plot by defining another color scale for the countries. Just having different shades of blue is not that helpful for distinguishing the countries.</p>
</div>
<div class="tips r">
<p>This is what your map could look like:</p>
<p><img src="plots/r-map-label.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<div class="tipsp python">
<p>For our last map, we are going to create a world map and color each country by its number of confirmed cases.
You should be able to use the data frame for confirmed cases from before. But before continuing, you may want to have a look at the ipyleaflet documentation for the layer <code>GeoJson</code>, which we are going to use here.</p>
<p>In contrast to before, when we only needed latitude and longitude for a country to place our circles, we now need all the coordinates of each country’s border to be able to draw it.
Thus, we’ve prepared a <code>.json</code> file for you with all border coordinates (i.e. country polygons) for each country, which is stored as <code>geo.json</code>.
You can load <code>.json</code> files into your jupyter notebook doing:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="exploratory-data-analysis.html#cb14-1"></a><span class="cf">with</span> <span class="bu">open</span>(‘<span class="op">/</span>PATH<span class="op">/</span>TO<span class="op">/</span>geo.json’, ‘r’) <span class="im">as</span> f:</span>
<span id="cb14-2"><a href="exploratory-data-analysis.html#cb14-2"></a>    world_map_dict <span class="op">=</span> json.load(f)</span></code></pre></div>
<p>This file contains a ton of data. Just notice that each list element in the dictionary key <code>features</code> contains the name of the country, as well as its coordinates (for example print <code>world_map_dict['features'][0]</code>).</p>
<p>In order to use the confirmed cases data frame for this map, we need to convert it into a dictionary with country names as keys and the respective number of confirmed cases as its values. We can achieve this in one line with dict comprehension and python’s built in zip function: <code>dict(zip(df.country, df.confirmed))</code>.</p>
<p>Now that we have our <code>confirmed cases</code> and the <code>borders</code> dictionaries, we may now take care of the coloring.
Again, we already prepared a json file called <code>colors.json</code>. Looking at its content in your Jupyter notebook, you will see that it has numbers stored as keys, and rgb-color-codes stored as the respective values. The numbers are actually the number of confirmed cases to which the colors “belong” to.
<code>ipyleaflet</code> requires us to make two lists out of this dictionary, because we need to pass both as separate arguments when instantiating the map’s <code>layer</code>.
You can create both lists in two lines using python’s list comprehension:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="exploratory-data-analysis.html#cb15-1"></a>color_list <span class="op">=</span> [v <span class="cf">for</span> k,v <span class="kw">in</span> color_codes.items()]</span>
<span id="cb15-2"><a href="exploratory-data-analysis.html#cb15-2"></a>nr_list <span class="op">=</span> [<span class="bu">float</span>(k) <span class="cf">for</span> k,v <span class="kw">in</span> color_codes.items()]  </span></code></pre></div>
</div>
<div class="tipsp python">
<p>Notice how we had to use python’s float method to convert the numbers to float, as they were stored as strings in our colors.json file.</p>
<p>That’s pretty much it! We can now create the <code>layer</code>-instance of the Choropleth class:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="exploratory-data-analysis.html#cb16-1"></a>layer <span class="op">=</span> ipyleaflet.Choropleth(</span>
<span id="cb16-2"><a href="exploratory-data-analysis.html#cb16-2"></a>    geo_data<span class="op">=</span>world_map_dict,</span>
<span id="cb16-3"><a href="exploratory-data-analysis.html#cb16-3"></a>    choro_data<span class="op">=</span>confirmed_dict,</span>
<span id="cb16-4"><a href="exploratory-data-analysis.html#cb16-4"></a>    colormap<span class="op">=</span>LinearColormap(colors<span class="op">=</span>color_list, index<span class="op">=</span>nr_list,</span>
<span id="cb16-5"><a href="exploratory-data-analysis.html#cb16-5"></a>                            vmin<span class="op">=</span><span class="dv">0</span>, vmax<span class="op">=</span>nr_list[<span class="op">-</span><span class="dv">1</span>]),</span>
<span id="cb16-6"><a href="exploratory-data-analysis.html#cb16-6"></a>    border_color<span class="op">=</span><span class="st">&#39;black&#39;</span>,</span>
<span id="cb16-7"><a href="exploratory-data-analysis.html#cb16-7"></a>    style<span class="op">=</span>{<span class="st">&#39;fillOpacity&#39;</span>: <span class="fl">0.8</span>, <span class="st">&#39;dashArray&#39;</span>: <span class="st">&#39;5, 5&#39;</span>})</span>
<span id="cb16-8"><a href="exploratory-data-analysis.html#cb16-8"></a> </span>
<span id="cb16-9"><a href="exploratory-data-analysis.html#cb16-9"></a>m <span class="op">=</span> Map(center<span class="op">=</span>(<span class="dv">43</span>, <span class="dv">0</span>), zoom<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb16-10"><a href="exploratory-data-analysis.html#cb16-10"></a>m.add_layer(layer)</span>
<span id="cb16-11"><a href="exploratory-data-analysis.html#cb16-11"></a>m</span></code></pre></div>
<p>Feel free to play around with the maps you created. Maybe try to insert some controls (see under <code>controls</code> in the ipyleaflet documentation), like the zoom-bar you can see in the picture below, or a full screen button.</p>
<p>This is how your map could look like:</p>
<p><img src="plots/p-map-color.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
<p>Congratulations! Because you put in the effort and determination you managed to perform data transformations as well as visualization techniques that are highly relevant for modern Data Science. You can proudly say that you now have acquired basic skills in the field of Data Science by successfully completing the first part of the project. If you are part of the beginner track you have fulfilled the necessary requirements. However, we do recommend that you have a look at the second part of the project and try and solve it as well. This is the part where it really gets interesting because we will have a look at methods of predicting the future. Sounds exciting? Then get ready!</p>

<div style="page-break-after: always;"></div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="introduction-to-your-project.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="covid-19-prediction.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["output.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
